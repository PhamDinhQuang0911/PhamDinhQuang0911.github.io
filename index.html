<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To√°n th·∫ßy Choang Choang - Luy·ªán thi t∆∞ duy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { brand: '#0F766E', accent: '#EA580C' },
                    animation: { 'float': 'float 3s ease-in-out infinite', 'fade-in': 'fadeIn 0.5s ease-out forwards' },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        fadeIn: { from: { opacity: '0', transform: 'translateY(10px)' }, to: { opacity: '1', transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Nunito', sans-serif; }
        .font-handwriting { font-family: 'Pacifico', cursive; }
        
        .text-brand { color: #0F766E; } 
        .bg-brand { background-color: #0F766E; }
        .hover-text-brand:hover { color: #115E59; }

        .bg-accent { background-color: #F97316; } 
        .hover-bg-accent:hover { background-color: #EA580C; }
        .text-accent { color: #F97316; }
        .border-accent { border-color: #F97316; }

        .bg-page { background-color: #F0FDFA; }

        .modal { transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-content { transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .modal.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .modal.hidden .modal-content { transform: scale(0.95) translateY(10px); }
        .animate-float { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        
        .course-card { transition: all 0.3s ease; }
        .course-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        
        /* Mobile Menu Animation */
        #mobile-menu { transition: max-height 0.3s ease-in-out; max-height: 0; overflow: hidden; }
        #mobile-menu.open { max-height: 400px; }
        /* --- 1. HI·ªÜU ·ª®NG R∆†I T·ª∞ ƒê·ªòNG --- */
        .falling-item {
            position: fixed;
            top: -10%;
            z-index: 9998; 
            user-select: none;
            pointer-events: none;
            animation-name: falling;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            opacity: 0.7; 
            filter: blur(0.5px); 
            text-shadow: 0 0 2px rgba(255,255,255,0.3); 
        }
        @keyframes wobble-slow { 0%, 100% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } }
        .decoration-animate { animation: wobble-slow 4s ease-in-out infinite; }

        @keyframes falling {
            0% { transform: translateY(0) rotate(0deg); opacity: 0.7; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
        }

        /* --- 2. C√ÅC THEME M√ÄU S·∫ÆC --- */
        body.theme-flag { background-color: #FEF2F2; } 
        body.theme-flag .text-brand { color: #B91C1C !important; } 
        body.theme-flag .bg-brand { background-color: #B91C1C !important; }
        body.theme-flag .bg-accent { background-color: #F59E0B !important; } 
        body.theme-flag .text-accent { color: #F59E0B !important; }

        body.theme-tet { background-color: #FFF7ED; } 
        body.theme-tet .text-brand { color: #DC2626 !important; } 
        body.theme-tet .bg-brand { background-color: #DC2626 !important; }
        body.theme-tet .bg-accent { background-color: #FCD34D !important; } 

        body.theme-teacher { background-color: #F0FDF4; } 
        body.theme-teacher .text-brand { color: #15803D !important; } 
        body.theme-teacher .bg-accent { background-color: #DB2777 !important; }

        body.theme-summer { background-color: #ECFEFF; } 
        body.theme-summer .text-brand { color: #0284C7 !important; } 
        body.theme-summer .bg-brand { background-color: #0284C7 !important; }

        body.theme-winter { background-color: #F8FAFC; }
        body.theme-winter .text-brand { color: #475569 !important; }
    </style>

</head>
<body class="bg-page flex flex-col min-h-screen">

    <header class="bg-white/95 backdrop-blur-md sticky top-0 z-40 border-b border-teal-100 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 md:h-20 flex items-center justify-between">
            <div id="siteLogoContainer" class="relative flex items-center cursor-pointer group" onclick="location.reload()">
                <div id="theme-decoration-container" class="absolute -bottom-3 -right-5 z-0 text-4xl filter drop-shadow-sm transition-all duration-500 opacity-90 group-hover:scale-110"></div>
                
                <div class="relative z-10 flex items-center gap-3">
                    <div class="logo-placeholder w-10 h-10 bg-gradient-to-br from-orange-500 to-yellow-400 rounded-xl flex items-center justify-center text-white text-xl shadow-lg shadow-orange-200">
                        <i class="fa-solid fa-graduation-cap"></i>
                    </div>
                    <span class="logo-text text-2xl font-black text-brand tracking-tight">Th·∫ßy Choang Choang</span>
                </div>
            </div>
            <nav class="hidden md:flex items-center gap-8 font-bold text-gray-600 text-sm uppercase tracking-wide">
                <a href="#" class="text-brand font-extrabold hover:text-orange-500 transition-colors">Trang ch·ªß</a>
                <a href="https://www.facebook.com/toanQmath" target="_blank" class="hover:text-brand transition-colors">Fanpage</a>
                <a href="#courses-section" class="hover:text-brand transition-colors">Kh√≥a h·ªçc</a>
                <a href="#contact" class="hover:text-brand transition-colors">Li√™n h·ªá</a>
            </nav>

            <div class="flex items-center gap-3">
                <button onclick="toggleRegisterModal(true)" class="hidden md:block px-5 py-2.5 text-brand font-bold border-2 border-brand bg-white rounded-xl hover:bg-teal-50 transition-all">
                    ƒêƒÉng k√Ω
                </button>
                <button onclick="toggleLoginModal(true)" class="hidden md:flex px-6 py-2.5 bg-accent text-white font-bold rounded-xl shadow-lg shadow-orange-200 hover-bg-accent hover:-translate-y-0.5 transition-all items-center gap-2">
                    <i class="fa-solid fa-arrow-right-to-bracket"></i> V√†o h·ªçc
                </button>
                
                <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-gray-600 hover:text-brand focus:outline-none">
                    <i class="fa-solid fa-bars text-2xl"></i>
                </button>
            </div>
        </div>

        <div id="mobile-menu" class="md:hidden bg-white border-b border-gray-100">
            <nav class="flex flex-col px-4 py-4 space-y-3 font-bold text-gray-600">
                <a href="#" class="block hover:text-brand">Trang ch·ªß</a>
                <a href="#courses-section" class="block hover:text-brand">Kh√≥a h·ªçc</a>
                <a href="#contact" class="block hover:text-brand">Li√™n h·ªá</a>
                <hr class="border-gray-100">
                <div class="flex gap-3 pt-2">
                    <button onclick="toggleRegisterModal(true)" class="flex-1 py-2 text-brand border border-brand rounded-lg text-center">ƒêƒÉng k√Ω</button>
                    <button onclick="toggleLoginModal(true)" class="flex-1 py-2 bg-accent text-white rounded-lg text-center shadow-md">V√†o h·ªçc</button>
                </div>
            </nav>
        </div>
    </header>

    <section id="heroSectionContainer" class="flex-1 flex flex-col relative overflow-hidden bg-white min-h-[500px] justify-center">
        <div class="m-auto text-center">
            <i class="fa-solid fa-circle-notch fa-spin text-4xl text-teal-600 mb-2"></i>
            <p class="text-gray-400 text-sm">ƒêang t·∫£i giao di·ªán...</p>
        </div>
    </section>

    <section id="courses-section" class="py-12 md:py-20 bg-white border-t border-teal-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-10 md:mb-16">
                <h2 class="text-brand font-bold text-lg uppercase tracking-wider mb-2">Ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o</h2>
                <h3 class="text-3xl md:text-4xl font-black text-gray-800">C√°c Kh√≥a H·ªçc N·ªïi B·∫≠t</h3>
                <div class="w-20 h-1.5 bg-accent mx-auto mt-4 rounded-full"></div>
            </div>

            <div id="courseListContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                <div class="col-span-full text-center text-gray-400 py-10">
                    <i class="fa-solid fa-spinner fa-spin mr-2"></i> ƒêang t·∫£i kh√≥a h·ªçc...
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-teal-800 text-white pt-12 pb-6" id="contact">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 md:gap-10 mb-8">
                <div class="lg:col-span-2">
                    <h3 class="font-bold text-lg mb-4 uppercase text-teal-200 border-b border-teal-600 pb-2 inline-block">Th√¥ng tin li√™n h·ªá</h3>
                    <ul class="space-y-4 text-white text-sm">
                        <li class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-teal-700 flex items-center justify-center text-accent"><i class="fa-solid fa-envelope"></i></div>
                            <span class="break-all">phamngockhanh.942001@gmail.com</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <div class="w-8 h-8 rounded-full bg-teal-700 flex items-center justify-center text-accent shrink-0"><i class="fa-solid fa-location-dot"></i></div>
                            <div>
                                <p class="font-bold text-teal-200">C∆° s·ªü 1:</p> 
                                <span>Ng·ªçc Mai, X√£ K·∫ª S·∫∑t, TP. H·∫£i Ph√≤ng</span>
                            </div>
                        </li>
                        <li class="flex items-start gap-3">
                            <div class="w-8 h-8 rounded-full bg-teal-700 flex items-center justify-center text-accent shrink-0"><i class="fa-solid fa-school"></i></div>
                            <div>
                                <p class="font-bold text-teal-200">C∆° s·ªü 2:</p> 
                                <span>Tr∆∞·ªùng TH v√† THCS Ng·ªçc L√¢m, Ph∆∞·ªùng ƒê∆∞·ªùng H√†o, T·ªânh H∆∞ng Y√™n</span>
                            </div>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold text-lg mb-4 uppercase text-teal-200 border-b border-teal-600 pb-2 inline-block">K·∫øt n·ªëi</h3>
                    <ul class="space-y-3 text-white text-sm">
                        <li><a href="https://www.facebook.com/QH1304" target="_blank" class="flex items-center gap-2 hover:text-accent transition-colors"><i class="fa-brands fa-facebook text-xl"></i> Facebook C√° Nh√¢n</a></li>
                        <li><a href="https://www.facebook.com/toanQmath" target="_blank" class="flex items-center gap-2 hover:text-accent transition-colors"><i class="fa-solid fa-flag text-xl"></i> Fanpage To√°n QMath</a></li>
                    </ul>
                </div>
            </div>
            <div class="text-center text-teal-300 text-xs font-bold border-t border-teal-700 pt-6">
                &copy; 2025 B·∫¢N QUY·ªÄN THU·ªòC V·ªÄ TH·∫¶Y PH·∫†M ƒê√åNH QUANG
            </div>
        </div>
    </footer>

    <div id="loginModal" class="modal hidden fixed inset-0 z-50 flex items-center justify-center bg-teal-900/40 backdrop-blur-sm p-4">
        <div class="modal-content bg-white w-full max-w-md rounded-[2rem] shadow-2xl relative overflow-hidden border-4 border-teal-50">
            <button onclick="toggleLoginModal(false)" class="absolute top-4 right-4 w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-gray-500 transition-colors z-10"><i class="fa-solid fa-times"></i></button>
            <div class="p-8 md:p-10">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-teal-100 text-brand rounded-2xl flex items-center justify-center text-3xl mx-auto mb-4"><i class="fa-solid fa-graduation-cap"></i></div>
                    <h2 class="text-3xl font-extrabold text-gray-800">ƒêƒÉng nh·∫≠p</h2>
                    <p class="text-gray-500 text-sm mt-1">Ch√†o m·ª´ng tr·ªü l·∫°i l·ªõp h·ªçc!</p>
                </div>
                <form id="loginForm" class="space-y-4">
                    <div><label class="block text-xs font-bold text-gray-700 mb-1 uppercase">T√™n ƒëƒÉng nh·∫≠p ho·∫∑c SƒêT</label><input type="text" id="emailInput" placeholder="VD: phamdinhquang ho·∫∑c 0912..." required class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-teal-200 focus:border-brand outline-none transition-all"></div>
                    <div><label class="block text-xs font-bold text-gray-700 mb-1 uppercase">M·∫≠t kh·∫©u</label><input type="password" id="passwordInput" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-teal-200 focus:border-brand outline-none transition-all"></div>
                    <button type="submit" id="submitBtn" class="w-full bg-accent hover-bg-accent text-white font-bold py-3.5 rounded-xl shadow-lg transition-all">ƒêƒÉng nh·∫≠p ngay</button>
                    <div class="relative text-center my-4"><span class="bg-white px-4 text-xs text-gray-400 font-bold">HO·∫∂C</span></div>
                    <button type="button" id="googleLoginBtn" class="w-full bg-white border border-gray-300 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-50 transition-all flex justify-center items-center gap-2"><i class="fa-brands fa-google text-red-500"></i> Google</button>
                </form>
                <div id="messageArea" class="mt-4 text-center text-sm font-bold hidden p-3 rounded-lg bg-gray-50"></div>
            </div>
        </div>
    </div>

    <div id="registerModal" class="modal hidden fixed inset-0 z-50 flex items-center justify-center bg-teal-900/40 backdrop-blur-sm p-4">
        <div class="modal-content bg-white w-full max-w-2xl rounded-[2rem] shadow-2xl relative overflow-hidden border-4 border-teal-50 max-h-[90vh] overflow-y-auto">
            <button onclick="toggleRegisterModal(false)" class="absolute top-4 right-4 w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-gray-500 transition-colors z-10"><i class="fa-solid fa-times"></i></button>
            <div class="bg-teal-50 p-6 text-center border-b border-teal-100">
                <div class="inline-flex items-center justify-center w-12 h-12 bg-white rounded-xl shadow-sm text-brand text-2xl mb-2"><i class="fa-solid fa-user-plus"></i></div>
                <h2 class="text-2xl font-black text-brand uppercase tracking-wide">ƒêƒÉng k√Ω t√†i kho·∫£n</h2>
            </div>
            <div class="p-6 md:p-8">
                <form id="registerForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-4">
                        <div><input type="text" id="regName" placeholder="H·ªç v√† t√™n (b·∫Øt bu·ªôc)" required class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-teal-200 outline-none text-sm"></div>
                        <div><input type="tel" id="regPhone" placeholder="S·ªë ƒëi·ªán tho·∫°i (b·∫Øt bu·ªôc)" required class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-teal-200 outline-none text-sm"></div>
                        <div><input type="text" id="regUsername" placeholder="T√™n ƒëƒÉng nh·∫≠p (vi·∫øt li·ªÅn)" required class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-teal-200 outline-none text-sm font-bold text-teal-700"></div>
                        <div><input type="password" id="regPass" placeholder="M·∫≠t kh·∫©u (b·∫Øt bu·ªôc)" required class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-teal-200 outline-none text-sm"></div>
                    </div>
                    <div class="space-y-4">
                        <div><input type="number" id="regYear" placeholder="NƒÉm sinh (b·∫Øt bu·ªôc)" required class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-teal-200 outline-none text-sm"></div>
                        <div><input type="text" id="regSchool" placeholder="Tr∆∞·ªùng (b·∫Øt bu·ªôc)" required class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-teal-200 outline-none text-sm"></div>
                         <div><input list="cities" type="text" id="regCity" placeholder="T·ªânh/Th√†nh ph·ªë..." class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-teal-200 outline-none text-sm"><datalist id="cities"><option value="H√† N·ªôi"><option value="H·ªì Ch√≠ Minh"><option value="H·∫£i Ph√≤ng"><option value="H∆∞ng Y√™n"><option value="H·∫£i D∆∞∆°ng"><option value="B·∫Øc Ninh"></datalist></div>
                         <div><input type="email" id="regEmail" placeholder="Email (t√πy ch·ªçn)" class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-teal-200 outline-none text-sm"></div>
                         <div><input type="tel" id="regParentPhone" placeholder="SƒêT Ph·ª• huynh" class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-teal-200 outline-none text-sm"></div>
                        <div><input type="password" id="regRePass" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u" required class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-teal-200 outline-none text-sm"></div>
                    </div>
                    <div class="col-span-1 md:col-span-2 mt-4">
                        <button type="submit" id="regBtn" class="w-full bg-accent hover-bg-accent text-white font-bold py-4 rounded-xl shadow-lg shadow-orange-200 transition-all uppercase tracking-wide">ƒêƒÇNG K√ù T√ÄI KHO·∫¢N</button>
                        <p class="text-center text-xs text-gray-500 mt-3">B·∫°n ƒë√£ c√≥ t√†i kho·∫£n? <a href="#" onclick="switchModal()" class="text-brand font-bold hover:underline">ƒêƒÇNG NH·∫¨P NGAY</a></p>
                    </div>
                </form>
                <div id="regMessage" class="mt-4 text-center text-sm font-bold hidden p-3 rounded-lg bg-gray-50"></div>
            </div>
        </div>
    </div>

    <script>
        function toggleLoginModal(show) { document.getElementById('loginModal').classList.toggle('hidden', !show); if(show) document.getElementById('registerModal').classList.add('hidden'); }
        function toggleRegisterModal(show) { document.getElementById('registerModal').classList.toggle('hidden', !show); if(show) document.getElementById('loginModal').classList.add('hidden'); }
        function switchModal() { toggleRegisterModal(false); toggleLoginModal(true); }
        function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('open'); }
    </script>
    <div id="paymentModal" class="modal opacity-0 pointer-events-none fixed inset-0 z-[100] bg-gray-50 flex flex-col transition-all duration-300 overflow-y-auto">
        <div class="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center sticky top-0 z-10 shadow-sm">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold"><i class="fa-solid fa-lock"></i></div>
                <div>
                    <h2 class="text-lg font-black text-gray-800 uppercase">Thanh to√°n an to√†n</h2>
                    <p class="text-xs text-gray-500">Th√¥ng tin ƒë∆∞·ª£c b·∫£o m·∫≠t tuy·ªát ƒë·ªëi</p>
                </div>
            </div>
            <button onclick="closePaymentModal()" class="text-gray-400 hover:text-red-500 flex items-center gap-2 font-bold px-4 py-2 hover:bg-red-50 rounded-lg transition-all">
                ƒê√≥ng <i class="fa-solid fa-times text-xl"></i>
            </button>
        </div>

        <div class="flex-1 max-w-7xl mx-auto w-full p-4 md:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <div class="lg:col-span-7 space-y-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-800 mb-4 border-b pb-2 flex items-center gap-2"><i class="fa-solid fa-user-circle text-blue-600"></i> Th√¥ng tin ƒëƒÉng k√Ω</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">H·ªç v√† t√™n</label>
                            <input type="text" id="payUserName" class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-gray-700 font-bold" readonly>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">S·ªë ƒëi·ªán tho·∫°i / Email</label>
                            <input type="text" id="payUserContact" class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-gray-700" readonly>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 relative overflow-hidden">
                    <div class="absolute top-0 right-0 bg-orange-100 text-orange-600 px-3 py-1 text-xs font-bold rounded-bl-xl">Khuy√™n d√πng</div>
                    <h3 class="font-bold text-gray-800 mb-4 border-b pb-2 flex items-center gap-2"><i class="fa-solid fa-university text-orange-600"></i> Th√¥ng tin chuy·ªÉn kho·∫£n</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <span class="text-xs text-gray-400 uppercase font-bold block mb-1">Ng√¢n h√†ng th·ª• h∆∞·ªüng</span>
                                <div class="font-bold text-blue-700 text-lg flex items-center gap-2">
                                    <i class="fa-solid fa-building-columns"></i> <span id="bankNameDisplay">...</span>
                                </div>
                            </div>
                            <div>
                                <span class="text-xs text-gray-400 uppercase font-bold block mb-1">Ch·ªß t√†i kho·∫£n</span>
                                <div class="font-bold text-gray-800 uppercase" id="accountNameDisplay">...</div>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="bg-orange-50 p-3 rounded-lg border border-orange-100">
                                <span class="text-xs text-orange-500 uppercase font-bold block mb-1">S·ªë t√†i kho·∫£n</span>
                                <div class="flex justify-between items-center">
                                    <span class="font-black text-2xl text-orange-600 tracking-wider" id="accountNoDisplay">...</span>
                                    <button onclick="copyText('accountNoDisplay')" class="text-xs bg-white text-orange-600 border border-orange-200 px-2 py-1 rounded hover:bg-orange-100"><i class="fa-regular fa-copy"></i></button>
                                </div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded-lg border border-blue-100">
                                <span class="text-xs text-blue-500 uppercase font-bold block mb-1">N·ªôi dung chuy·ªÉn kho·∫£n (B·∫Øt bu·ªôc)</span>
                                <div class="flex justify-between items-center">
                                    <span class="font-black text-lg text-blue-700" id="transferContentDisplay">...</span>
                                    <button onclick="copyText('transferContentDisplay')" class="text-xs bg-white text-blue-600 border border-blue-200 px-2 py-1 rounded hover:bg-blue-100"><i class="fa-regular fa-copy"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-5 space-y-6">
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 sticky top-24">
                    <h3 class="font-bold text-gray-800 mb-4 uppercase tracking-wide">ƒê∆°n h√†ng c·ªßa b·∫°n</h3>
                    
                    <div class="flex gap-4 mb-4 pb-4 border-b border-gray-100">
                        <img id="payCourseImg" src="" class="w-20 h-20 object-cover rounded-lg border border-gray-200">
                        <div>
                            <div id="payCourseTag" class="inline-block text-[10px] font-bold bg-teal-100 text-teal-700 px-2 py-0.5 rounded mb-1">KH√ìA H·ªåC</div>
                            <h4 id="payCourseTitle" class="font-bold text-gray-800 line-clamp-2">...</h4>
                        </div>
                    </div>

                    <div class="space-y-2 text-sm text-gray-600 mb-6">
                        <div class="flex justify-between"><span>Gi√° g·ªëc:</span><span id="payOriginalPrice" class="line-through text-gray-400">0ƒë</span></div>
                        <div class="flex justify-between text-green-600 font-bold"><span>Gi·∫£m gi√°:</span><span id="payDiscount">-0ƒë</span></div>
                        <div class="flex justify-between text-xl font-black text-gray-900 border-t border-dashed border-gray-300 pt-3 mt-2">
                            <span>T·ªîNG THANH TO√ÅN:</span>
                            <span id="payFinalPrice" class="text-orange-600">0ƒë</span>
                        </div>
                    </div>

                    <div class="bg-gray-50 rounded-xl p-4 text-center border-2 border-dashed border-blue-200 mb-6 group relative">
                        <p class="text-xs font-bold text-gray-500 mb-2 uppercase">Qu√©t m√£ QR ƒë·ªÉ thanh to√°n nhanh</p>
                        <div class="relative w-48 mx-auto bg-white p-2 rounded-lg shadow-sm">
                            <img id="vietQrImage" src="" class="w-full h-full object-contain" alt="QR Code">
                            <div id="qrLoading" class="absolute inset-0 bg-white flex flex-col items-center justify-center z-10"><i class="fa-solid fa-spinner fa-spin text-2xl text-blue-600 mb-2"></i><span class="text-[10px] font-bold text-gray-400">ƒêang t·∫°o QR...</span></div>
                        </div>
                        <p class="text-[10px] text-gray-400 mt-2 italic">M·ªü ·ª©ng d·ª•ng ng√¢n h√†ng > Ch·ªçn Qu√©t QR</p>
                    </div>

                    <button onclick="confirmPayment()" class="w-full py-4 bg-gradient-to-r from-blue-600 to-blue-800 text-white font-bold rounded-xl shadow-lg hover:shadow-blue-300 hover:scale-[1.02] transition-all transform flex items-center justify-center gap-2">
                        <i class="fa-solid fa-check-circle text-xl"></i> X√ÅC NH·∫¨N ƒê√É CHUY·ªÇN KHO·∫¢N
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, updateProfile, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, addDoc, collection, getDocs, query, where, orderBy, enableIndexedDbPersistence } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        // --- LOGIC T·ª∞ ƒê·ªòNG ƒê·ªîI GIAO DI·ªÜN THEO M√ôA & S·ª∞ KI·ªÜN ---
        // --- LOGIC T·ª∞ ƒê·ªòNG ƒê·ªîI GIAO DI·ªÜN & TRANG TR√ç LOGO (N√ÇNG C·∫§P) ---
        (function autoApplyTheme() {
            try {
                const today = new Date();
                const currentYear = today.getFullYear();
                const month = today.getMonth() + 1;

                // C·∫§U H√åNH NG√ÄY L·ªÑ (Th√™m decoration: icon trang tr√≠ c·∫°nh logo)
                const events = [
                    { name: "T·∫øt D∆∞∆°ng L·ªãch", date: [1, 1], rangeBefore: 10, rangeAfter: 3, theme: "theme-tet", icon: "‚ú®", count: 15, decoration: "üéâ" },
                    { name: "T·∫øt Nguy√™n ƒê√°n 2025", date: [1, 29], rangeBefore: 25, rangeAfter: 10, theme: "theme-tet", icon: "üå∏", count: 20, decoration: "üßß<span class='text-sm absolute -left-2 top-4'>üå∏</span>" },
                    { name: "Gi·ªó T·ªï H√πng V∆∞∆°ng", date: [4, 7], rangeBefore: 10, rangeAfter: 2, theme: "theme-flag", icon: "üíõ", count: 10, decoration: "ü•Å" },
                    { name: "30/4 & 1/5", date: [4, 30], rangeBefore: 15, rangeAfter: 5, theme: "theme-flag", icon: "‚≠ê", count: 15, decoration: "üáªüá≥" },
                    { name: "Qu·ªëc Kh√°nh 2/9", date: [9, 2], rangeBefore: 15, rangeAfter: 5, theme: "theme-flag", icon: "üáªüá≥", count: 15, decoration: "‚≠ê" },
                    { name: "Nh√† gi√°o VN 20/11", date: [11, 20], rangeBefore: 20, rangeAfter: 5, theme: "theme-teacher", icon: "üåπ", count: 15, decoration: "üíê" },
                    // Gi√°ng sinh: Th√™m ng∆∞·ªùi tuy·∫øt c·∫°nh logo
                    { name: "Gi√°ng Sinh", date: [12, 25], rangeBefore: 25, rangeAfter: 5, theme: "theme-winter", icon: "‚ùÑÔ∏è", count: 25, decoration: "<span class='decoration-animate inline-block'>‚õÑ</span>" }
                ];

                function checkEvent(ev) {
                    const eventDate = new Date(currentYear, ev.date[0] - 1, ev.date[1]);
                    const diffTime = eventDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                    return (diffDays >= 0 && diffDays <= ev.rangeBefore) || (diffDays < 0 && Math.abs(diffDays) <= ev.rangeAfter);
                }

                // H√†m t·∫°o hi·ªáu ·ª©ng r∆°i (T·∫≠p trung b√™n tr√°i)
                function createEffect(icon, count) {
                    for (let i = 0; i < count; i++) {
                        const el = document.createElement('div');
                        el.classList.add('falling-item');
                        el.innerHTML = icon;
                        // V·ªã tr√≠ r∆°i: T·∫≠p trung 70% v√†o n·ª≠a tr√°i m√†n h√¨nh (50vw), 30% r∆°i ng·∫´u nhi√™n to√†n m√†n h√¨nh
                        const randomPos = Math.random() > 0.3 ? Math.random() * 50 : Math.random() * 95;
                        el.style.left = randomPos + 'vw';
                        
                        // K√≠ch th∆∞·ªõc v√† t·ªëc ƒë·ªô ng·∫´u nhi√™n ƒë·ªÉ t·ª± nhi√™n h∆°n
                        const size = Math.random() * 15 + 10; // 10px - 25px
                        el.style.fontSize = size + 'px';
                        el.style.opacity = Math.random() * 0.5 + 0.3; // ƒê·ªô m·ªù ng·∫´u nhi√™n (0.3 - 0.8)
                        
                        el.style.animationDuration = (Math.random() * 8 + 7) + 's'; // R∆°i ch·∫≠m (7s - 15s)
                        el.style.animationDelay = (Math.random() * 5) + 's';
                        document.body.appendChild(el);
                    }
                }

                // H√†m √°p d·ª•ng decoration c·∫°nh logo
                function applyDecoration(html) {
                    const container = document.getElementById('theme-decoration-container');
                    if (container && html) {
                        container.innerHTML = html;
                    }
                }

                // --- LOGIC CH√çNH ---
                let activeEvent = null;
                for (let ev of events) {
                    if (checkEvent(ev)) {
                        activeEvent = ev;
                        break; 
                    }
                }

                if (activeEvent) {
                    console.log("üî• K√≠ch ho·∫°t s·ª± ki·ªán: " + activeEvent.name);
                    document.body.classList.add(activeEvent.theme);
                    createEffect(activeEvent.icon, activeEvent.count);
                    applyDecoration(activeEvent.decoration); // Th√™m trang tr√≠ logo
                } else {
                    // CHECK M√ôA
                    if (month >= 5 && month <= 7) {
                        document.body.classList.add('theme-summer');
                        applyDecoration("<span>‚òÄÔ∏è</span>");
                    } else if (month >= 11 || month === 1 || month === 12) { // M√πa ƒê√¥ng
                        document.body.classList.add('theme-winter');
                        createEffect("‚ùÑÔ∏è", 15); // R∆°i √≠t tuy·∫øt h∆°n
                        applyDecoration("<span class='decoration-animate inline-block'>‚õÑ</span>"); // Ng∆∞·ªùi tuy·∫øt m√πa ƒë√¥ng
                    }
                }
            } catch (e) { console.warn("L·ªói Theme Manager:", e); }
        })();
        // --- D√ÅN C·∫§U H√åNH FIREBASE C·ª¶A ANH V√ÄO ƒê√ÇY ---
        const firebaseConfig = {
            apiKey: "AIzaSyCqAX3x1MbJ3do7m3EaH9JA4kFuVhlAc78",
            authDomain: "lms-thitracnghiem.firebaseapp.com",
            projectId: "lms-thitracnghiem",
            storageBucket: "lms-thitracnghiem.firebasestorage.app",
            messagingSenderId: "760187217240",
            appId: "1:760187217240:web:d043cd5808c349f87a712d"
        };
        
        // Kh·ªüi t·∫°o Firebase (ƒê√£ k√≠ch ho·∫°t Cache Offline)
        let app, auth, db;
        try {
             app = initializeApp(firebaseConfig);
             auth = getAuth(app);
             db = getFirestore(app);

             // --- K√çCH HO·∫†T CACHE: GI√öP LOAD TRANG NGAY L·∫¨P T·ª®C ---
             enableIndexedDbPersistence(db).catch((err) => {
                 if (err.code == 'failed-precondition') {
                     console.log('L·ªói: ƒêang m·ªü qu√° nhi·ªÅu tab (Ch·ªâ 1 tab ƒë∆∞·ª£c d√πng cache).');
                 } else if (err.code == 'unimplemented') {
                     console.log('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ cache.');
                 }
             });
        } catch(e) { console.error("L·ªói kh·ªüi t·∫°o Firebase:", e); }

        const googleProvider = new GoogleAuthProvider();

        onAuthStateChanged(auth, async (user) => { // Th√™m t·ª´ kh√≥a async
            if (user) {
                // --- TR∆Ø·ªúNG H·ª¢P 1: ƒê√É ƒêƒÇNG NH·∫¨P -> CHUY·ªÇN H∆Ø·ªöNG NGAY (KH√îNG T·∫¢I GIAO DI·ªÜN INDEX) ---
                const ADMIN_EMAILS = ["phamngockhanh.942001@gmail.com", "phamngockhanh.942002@gmail.com", "admin@gmail.com", "phamdinhquang0911@gmail.com"];
                
                // ∆Øu ti√™n: Chuy·ªÉn ƒë·∫øn ƒë·ªÅ thi ƒëang ch·ªù (n·∫øu c√≥)
                const pendingUrl = sessionStorage.getItem('pendingExamUrl');
                if (pendingUrl) {
                    sessionStorage.removeItem('pendingExamUrl');
                    window.location.href = pendingUrl;
                    return; 
                }

                // ƒêi·ªÅu h∆∞·ªõng theo vai tr√≤
                if (ADMIN_EMAILS.includes(user.email)) {
                    window.location.href = "dashboard.html"; 
                } else {
                    window.location.href = "student.html";   
                }
            } else {
                // --- TR∆Ø·ªúNG H·ª¢P 2: KH√ÅCH V√ÉNG LAI -> T·∫¢I KH√îNG CH·∫∂N (NON-BLOCKING) ---
                console.log("Kh√°ch v√£ng lai: B·∫Øt ƒë·∫ßu t·∫£i giao di·ªán...");
                
                // G·ªçi h√†m ngay l·∫≠p t·ª©c ƒë·ªÉ hi·ªán Skeleton v√† Cache (Kh√¥ng d√πng await ƒë·ªÉ ch·∫∑n)
                loadHeroSettings();
                renderCoursesFromDB();

                // Logic m·ªü form ƒëƒÉng k√Ω n·∫øu c√≥ link gi·ªõi thi·ªáu
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('mode') === 'register') {
                    setTimeout(() => {
                        if(window.toggleRegisterModal) window.toggleRegisterModal(true);
                    }, 1000); // TƒÉng delay x√≠u ƒë·ªÉ giao di·ªán ·ªïn ƒë·ªãnh
                }
            }
        });

        // 1. RENDER BANNER (STYLE 1, 2, 3)
        // --- 1. RENDER BANNER (5 STYLES + LOGO + TAGS M·ªöI) ---
        // --- RENDER BANNER (5 STYLES ƒê√É TINH CH·ªàNH) ---
        // --- RENDER BANNER & LOGO (ƒê√É KH·∫ÆC PH·ª§C M·∫§T CH·ªÆ) ---
        // --- LOGIC SLIDER (TR√åNH CHI·∫æU) ---
        window.heroSliderInterval = null;
        window.currentSlideIndex = 0;

        // H√†m t·∫°o HTML cho Slider
        function createSlider(images, styleClass = "") {
            // N·∫øu kh√¥ng c√≥ ·∫£nh ho·∫∑c ch·ªâ 1 ·∫£nh -> Hi·ªán ·∫£nh tƒ©nh
            if (!images || images.length === 0) return '';
            if (images.length === 1) return `<img src="${images[0]}" class="${styleClass}">`;

            // T·∫°o c√°c Slide
            let slidesHtml = images.map((img, idx) => `
                <div class="hero-slide absolute inset-0 transition-opacity duration-700 ease-in-out ${idx === 0 ? 'opacity-100 z-10' : 'opacity-0 z-0'}" data-index="${idx}">
                    <img src="${img}" class="${styleClass}">
                </div>
            `).join('');

            // T·∫°o n√∫t ƒëi·ªÅu h∆∞·ªõng (M≈©i t√™n & Ch·∫•m tr√≤n)
            const navHtml = `
                <button onclick="changeHeroSlide(-1)" class="absolute left-2 top-1/2 -translate-y-1/2 z-20 w-8 h-8 md:w-10 md:h-10 bg-white/40 hover:bg-white/90 backdrop-blur rounded-full flex items-center justify-center text-gray-800 shadow-lg transition-all"><i class="fa-solid fa-chevron-left"></i></button>
                <button onclick="changeHeroSlide(1)" class="absolute right-2 top-1/2 -translate-y-1/2 z-20 w-8 h-8 md:w-10 md:h-10 bg-white/40 hover:bg-white/90 backdrop-blur rounded-full flex items-center justify-center text-gray-800 shadow-lg transition-all"><i class="fa-solid fa-chevron-right"></i></button>
                <div class="absolute bottom-4 left-1/2 -translate-x-1/2 z-20 flex gap-2">
                    ${images.map((_, idx) => `<div class="hero-dot w-2 h-2 rounded-full transition-all shadow-sm ${idx===0 ? 'w-6 bg-orange-500' : 'bg-white/60 hover:bg-white'}" onclick="goToHeroSlide(${idx})"></div>`).join('')}
                </div>
            `;

            // T·ª± ƒë·ªông ch·∫°y Slide
            if(window.heroSliderInterval) clearInterval(window.heroSliderInterval);
            window.heroSliderInterval = setInterval(() => window.changeHeroSlide(1), 5000); 

            return `<div class="relative w-full h-full group select-none">${slidesHtml}${navHtml}</div>`;
        }

        // H√†m chuy·ªÉn Slide
        window.changeHeroSlide = (step) => {
            const slides = document.querySelectorAll('.hero-slide');
            const dots = document.querySelectorAll('.hero-dot');
            if(slides.length === 0) return;

            // ·∫®n slide c≈©
            slides[window.currentSlideIndex].classList.replace('opacity-100', 'opacity-0');
            slides[window.currentSlideIndex].classList.replace('z-10', 'z-0');
            if(dots[window.currentSlideIndex]) {
                dots[window.currentSlideIndex].classList.remove('w-6', 'bg-orange-500');
                dots[window.currentSlideIndex].classList.add('w-2', 'bg-white/60');
            }

            // T√≠nh index m·ªõi
            window.currentSlideIndex = (window.currentSlideIndex + step + slides.length) % slides.length;

            // Hi·ªán slide m·ªõi
            slides[window.currentSlideIndex].classList.replace('opacity-0', 'opacity-100');
            slides[window.currentSlideIndex].classList.replace('z-0', 'z-10');
            if(dots[window.currentSlideIndex]) {
                dots[window.currentSlideIndex].classList.remove('w-2', 'bg-white/60');
                dots[window.currentSlideIndex].classList.add('w-6', 'bg-orange-500');
            }
        };
        
        // H√†m nh·∫£y t·ªõi slide c·ª• th·ªÉ (khi b·∫•m dot)
        window.goToHeroSlide = (index) => {
             const diff = index - window.currentSlideIndex;
             if(diff !== 0) window.changeHeroSlide(diff);
        };

        // --- RENDER BANNER CH√çNH (UPDATE SLIDER & SIZE) ---
        function renderHero(d) {
            // 1. Logo + Ch·ªØ (Gi·ªØ nguy√™n logic ƒë√£ s·ª≠a)
            if (d.logo) {
                const logoContainer = document.getElementById('siteLogoContainer');
                if (logoContainer) logoContainer.innerHTML = `<img src="${d.logo}" alt="Logo" class="h-10 w-10 md:h-12 md:w-12 object-contain rounded-lg shadow-sm"><span class="text-xl md:text-2xl text-brand font-handwriting pt-1 ml-2">Th·∫ßy Choang</span>`;
            }

            const container = document.getElementById('heroSectionContainer');
            if (!container) return;
            const style = d.style || 'style1';
            
            // X·ª≠ l√Ω Tags
            let tagsHtml = '';
            if (d.tags && Array.isArray(d.tags)) tagsHtml = d.tags.map(tag => `<span class="bg-teal-50 text-teal-700 px-3 py-1 rounded-md text-[10px] md:text-xs font-bold border border-teal-200 uppercase tracking-wider shadow-sm">${tag}</span>`).join(' ');
            else if (d.tag1) tagsHtml = `<span class="bg-teal-50 text-teal-700 px-3 py-1 rounded-md text-[10px] md:text-xs font-bold border border-teal-200">${d.tag1}</span>`;

            // Chu·∫©n b·ªã ·∫£nh cho Slider
            const images = (d.images && d.images.length > 0) ? d.images : (d.image ? [d.image] : []);
            
            let html = '';

            // --- STYLE 1: C·ªî ƒêI·ªÇN (ƒê√É FIX: ·∫¢nh to h∆°n, gi·∫£m padding) ---
            if (style === 'style1') {
                container.className = "flex-1 flex items-center relative overflow-hidden bg-gradient-to-br from-teal-50 via-white to-blue-50 py-6 md:py-10"; // Gi·∫£m py
                // TƒÉng max-height c·ªßa ·∫£nh l√™n 500px v√† d√πng object-contain ƒë·ªÉ l·∫•p ƒë·∫ßy
                const slider = createSlider(images, "w-full h-full object-contain drop-shadow-2xl animate-float-slow mx-auto");
                html = `
                <div class="max-w-7xl mx-auto px-4 w-full grid grid-cols-1 lg:grid-cols-2 gap-6 items-center relative z-10 h-full">
                    <div class="text-center lg:text-left order-2 lg:order-1 space-y-4">
                        <h1 class="font-black text-gray-800 leading-tight">
                            <span class="text-2xl md:text-4xl block mb-1">${d.title1}</span>
                            <span class="text-xl md:text-3xl text-transparent bg-clip-text bg-gradient-to-r from-teal-600 to-orange-500">${d.title2}</span>
                        </h1>
                        <div class="flex flex-wrap gap-2 justify-center lg:justify-start pt-1">${tagsHtml}</div>
                        <p class="text-sm md:text-base text-gray-600 font-medium max-w-xl mx-auto lg:mx-0 leading-relaxed">${d.desc}</p>
                        <div class="pt-2">
                            <a href="${d.btnLink}" class="inline-block px-6 py-3 bg-accent text-white font-bold rounded-xl shadow-lg hover:shadow-orange-300 transition-transform hover:scale-105 uppercase tracking-wide text-xs md:text-sm">${d.btnText}</a>
                        </div>
                    </div>
                    <div class="relative order-1 lg:order-2 flex justify-center h-[350px] md:h-[500px] w-full p-2">
                        ${slider}
                    </div>
                </div>`;
            } 
            // --- STYLE 2: HI·ªÜN ƒê·∫†I (Slider) ---
            else if (style === 'style2') {
                container.className = "flex-1 pt-12 bg-white relative overflow-hidden flex flex-col items-center";
                const slider = createSlider(images, "w-full h-full object-cover rounded-t-2xl");
                html = `
                <div class="max-w-4xl mx-auto px-4 text-center z-10 mb-8">
                    <h1 class="font-black text-gray-900 mb-3 tracking-tight"><span class="block text-2xl md:text-4xl mb-1">${d.title1}</span><span class="text-xl md:text-3xl text-accent">${d.title2}</span></h1>
                    <div class="flex flex-wrap gap-2 justify-center mb-4 opacity-90">${tagsHtml}</div>
                    <p class="text-sm md:text-base text-gray-500 max-w-2xl mx-auto mb-6">${d.desc}</p>
                    <a href="${d.btnLink}" class="px-8 py-3 bg-gray-900 text-white font-bold rounded-full hover:bg-gray-800 transition-all shadow-xl text-xs md:text-sm">${d.btnText} <i class="fa-solid fa-arrow-right ml-2"></i></a>
                </div>
                <div class="w-full max-w-5xl px-4 mt-auto h-[300px] md:h-[500px]">
                    <div class="w-full h-full shadow-2xl border-t border-x border-gray-100 rounded-t-2xl relative">
                        ${slider}
                    </div>
                </div>`;
            }
            // --- STYLE 3: DARK MODE (ƒê√É FIX: ·∫¢nh to h∆°n) ---
            else if (style === 'style3') {
                container.className = "flex-1 bg-gray-900 text-white py-10 md:py-16 relative overflow-hidden flex items-center";
                // TƒÉng k√≠ch th∆∞·ªõc khung ·∫£nh
                const slider = createSlider(images, "relative w-full h-full object-contain rounded shadow-2xl shadow-teal-500/10 grayscale hover:grayscale-0 transition-all duration-700");
                html = `
                <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-5"></div>
                <div class="absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-teal-900/30 to-transparent"></div>
                <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-2 gap-8 items-center relative z-10 h-full">
                    <div>
                        <div class="w-12 h-1 bg-accent mb-4"></div>
                        <h1 class="font-bold mb-4 leading-none"><span class="block text-2xl md:text-4xl mb-2">${d.title1}</span><span class="text-xl md:text-3xl text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-yellow-300">${d.title2}</span></h1>
                        <div class="flex flex-wrap gap-2 mb-4">${tagsHtml}</div>
                        <p class="text-gray-400 text-sm mb-6 border-l-2 border-gray-700 pl-4">${d.desc}</p>
                        <a href="${d.btnLink}" class="px-6 py-2.5 border border-accent text-accent font-bold hover:bg-accent hover:text-white transition-all uppercase tracking-widest text-xs rounded">${d.btnText}</a>
                    </div>
                    <div class="relative flex justify-center h-[350px] md:h-[450px] w-full">
                        <div class="absolute -inset-4 bg-accent/10 rounded-full blur-3xl"></div>
                        ${slider}
                    </div>
                </div>`;
            }
            // --- STYLE 4: POSTER (Slider Full) ---
            else if (style === 'style4') {
                container.className = "flex-1 relative min-h-[500px] flex items-center";
                const slider = createSlider(images, "w-full h-full object-cover");
                html = `
                <div class="absolute inset-0 z-0">
                    ${slider}
                    <div class="absolute inset-0 bg-black/40 z-10 pointer-events-none"></div> 
                </div>
                <div class="max-w-7xl mx-auto px-4 relative z-20 w-full text-white">
                    <div class="max-w-xl bg-black/40 backdrop-blur-md p-6 md:p-10 rounded-2xl border border-white/10 shadow-2xl">
                        <div class="flex flex-wrap gap-2 mb-3">${tagsHtml}</div>
                        <h1 class="font-black mb-3 leading-tight"><span class="block text-2xl md:text-4xl text-white">${d.title1}</span><span class="text-xl md:text-3xl text-orange-400">${d.title2}</span></h1>
                        <p class="text-gray-200 text-sm md:text-base mb-6">${d.desc}</p>
                        <a href="${d.btnLink}" class="px-6 py-3 bg-white text-gray-900 font-bold rounded hover:bg-gray-200 transition-all uppercase tracking-wide text-xs shadow-lg">${d.btnText}</a>
                    </div>
                </div>`;
            }
            // --- STYLE 5: PH√Å C√ÅCH (Slider) ---
            else if (style === 'style5') {
                container.className = "flex-1 bg-white relative overflow-hidden flex flex-col md:flex-row";
                const slider = createSlider(images, "absolute inset-0 w-full h-full object-cover z-0");
                html = `
                <div class="w-full md:w-1/2 p-8 md:p-16 flex flex-col justify-center bg-gray-50 z-20 shadow-xl">
                    <h1 class="text-2xl md:text-4xl font-black text-gray-800 mb-1">${d.title1}</h1>
                    <h2 class="text-xl md:text-3xl font-black text-brand mb-4">${d.title2}</h2>
                    <div class="flex flex-wrap gap-2 mb-4">${tagsHtml}</div>
                    <p class="text-gray-600 mb-6 text-sm leading-relaxed">${d.desc}</p>
                    <div><a href="${d.btnLink}" class="px-6 py-3 bg-brand text-white font-bold rounded-tl-xl rounded-br-xl shadow-lg hover:shadow-brand/50 transition-all text-xs uppercase">${d.btnText}</a></div>
                </div>
                <div class="w-full md:w-1/2 relative min-h-[300px]">
                    ${slider}
                    <div class="absolute inset-y-0 left-0 w-20 bg-gradient-to-r from-gray-50 to-transparent z-10 pointer-events-none"></div>
                </div>`;
            }

            container.innerHTML = html;
        }

        async function loadHeroSettings() {
            try {
                const docSnap = await getDoc(doc(db, "site_settings", "homepage_hero"));
                if (docSnap.exists()) {
                    renderHero(docSnap.data());
                } else {
                    renderHero({style:'style1', title1:'H·ªÜ TH·ªêNG LMS', title2:'TH√îNG MINH', tag1:'30 ƒê·ªÄ THI', tag2:'VIDEO', desc:'N·ªÅn t·∫£ng h·ªçc t·∫≠p.', btnText:'B·∫ÆT ƒê·∫¶U', btnLink:'#', image:'https://cdn-icons-png.flaticon.com/512/3426/3426653.png'});
                }
            } catch (e) { console.warn("L·ªói t·∫£i Banner:", e); }
        }

        // 2. RENDER COURSES (C√ì GI·∫¢M GI√Å)
        async function renderCoursesFromDB() {
            const container = document.getElementById('courseListContainer');
            if (!container) return;

            // 1. HI·ªÜN SKELETON (Giao di·ªán gi·∫£ l·∫≠p trong l√∫c ch·ªù)
            // Gi√∫p b·ªë c·ª•c trang hi·ªán ra ngay l·∫≠p t·ª©c
            const skeletonCard = `
                <div class="bg-white rounded-2xl overflow-hidden border border-gray-100 shadow-sm h-full animate-pulse">
                    <div class="h-48 bg-gray-200"></div>
                    <div class="p-6 space-y-3">
                        <div class="h-6 bg-gray-200 rounded w-3/4"></div>
                        <div class="h-4 bg-gray-200 rounded w-full"></div>
                        <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                        <div class="h-10 bg-gray-200 rounded w-full mt-4"></div>
                    </div>
                </div>`;
            
            // Render 3 c√°i skeleton
            container.innerHTML = skeletonCard + skeletonCard + skeletonCard;

            try {
                // 2. T·∫£i d·ªØ li·ªáu (∆Øu ti√™n l·∫•y t·ª´ Cache ·ªï c·ª©ng tr∆∞·ªõc -> Hi·ªÉn th·ªã ngay 0s)
                const q = query(collection(db, "public_courses"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-10">Ch∆∞a c√≥ kh√≥a h·ªçc n√†o ƒë∆∞·ª£c ƒëƒÉng.</div>';
                    return;
                }

                let html = '';
                querySnapshot.forEach((doc) => {
                    const c = doc.data();
                    const price = parseInt(c.price) || 0;
                    const originalPrice = parseInt(c.originalPrice) || 0;
                    let priceHtml = '', discountBadge = '';
                    
                    // Logic hi·ªÉn th·ªã gi·∫£m gi√°
                    if (originalPrice > price && price > 0) {
                        const percent = Math.round(((originalPrice - price) / originalPrice) * 100);
                        discountBadge = `<span class="absolute top-3 left-3 bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow-md z-10 animate-pulse">-${percent}%</span>`;
                        priceHtml = `<div class="flex flex-col items-end"><span class="text-xs text-gray-400 line-through decoration-gray-400">${originalPrice.toLocaleString('vi-VN')}ƒë</span><span class="text-base font-bold text-accent">${price.toLocaleString('vi-VN')}ƒë</span></div>`;
                    } else {
                        if (c.tag) discountBadge = `<span class="absolute top-3 left-3 bg-accent text-white text-xs font-bold px-3 py-1 rounded-full shadow-md uppercase">${c.tag}</span>`;
                        priceHtml = `<span class="text-base font-bold text-brand">${price > 0 ? price.toLocaleString('vi-VN') + 'ƒë' : 'Mi·ªÖn ph√≠'}</span>`;
                    }
                    
                    // Fix ·∫£nh l·ªói b·∫±ng placehold.co
                    const imgSrc = c.image || c.thumbnail || 'https://placehold.co/400x200?text=No+Image';

                    html += `
                    <div class="course-card bg-white rounded-2xl overflow-hidden border border-gray-100 shadow-sm flex flex-col h-full group hover:shadow-xl transition-all duration-300">
                        <div class="relative h-48 overflow-hidden">
                            <img src="${imgSrc}" alt="${c.title}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500">
                            ${discountBadge}
                            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"></div>
                        </div>
                        <div class="p-6 flex-1 flex flex-col">
                            <h3 class="text-xl font-extrabold text-gray-800 mb-2 line-clamp-2 hover:text-brand transition-colors cursor-pointer" onclick="toggleRegisterModal(true)">${c.title}</h3>
                            <p class="text-gray-500 text-sm mb-4 line-clamp-2 flex-1">${c.desc || c.shortDesc || 'Ch∆∞a c√≥ m√¥ t·∫£.'}</p>
                            
                            <div class="border-t border-gray-100 pt-4 flex items-center justify-between mt-auto">
                                <div class="flex items-center gap-2 text-sm text-gray-500 font-bold">
                                    <i class="fa-solid fa-users text-teal-500"></i> ${c.fakeStudents || c.students || 0}
                                </div>
                                ${priceHtml}
                            </div>
                            <div class="mt-4">
                            <button onclick="openPaymentModal('${c.id}')" class="w-full py-2 bg-orange-50 text-accent font-bold rounded-lg text-sm hover:bg-accent hover:text-white transition-all flex justify-center items-center gap-2 shadow-sm">
                                ƒêƒÉng k√Ω ngay <i class="fa-solid fa-cart-shopping"></i>
                            </button>
                        </div>
                        </div>
                    </div>`;
                });
                
                container.innerHTML = html;
            } catch (error) {
                console.error("L·ªói t·∫£i kh√≥a h·ªçc:", error);
                // Fallback n·∫øu ch∆∞a t·∫°o index ho·∫∑c l·ªói m·∫°ng
                try {
                     const snap = await getDocs(collection(db, "public_courses"));
                     if(!html) container.innerHTML = '<div class="col-span-full text-center text-red-400">Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.</div>';
                } catch(e){}
            }
        }

        // 3. AUTH LOGIC
        const loginForm = document.getElementById('loginForm');
        const emailInput = document.getElementById('emailInput');
        const passwordInput = document.getElementById('passwordInput');
        const submitBtn = document.getElementById('submitBtn');
        const messageArea = document.getElementById('messageArea');

        function showMessage(msg, type = 'success') {
            messageArea.textContent = msg;
            messageArea.classList.remove('hidden', 'text-green-600', 'text-red-600', 'bg-green-100', 'bg-red-100');
            messageArea.classList.add(type === 'success' ? 'text-green-600' : 'text-red-600');
            messageArea.classList.add(type === 'success' ? 'bg-green-100' : 'bg-red-100');
            messageArea.classList.remove('hidden');
        }

        async function saveUserData(user, method) {
             try {
                await setDoc(doc(db, "users", user.uid), {
                    email: user.email, lastLogin: new Date().toISOString(), authType: method,
                    displayName: user.displayName || user.email.split('@')[0], photoURL: user.photoURL || ""
                }, { merge: true });
            } catch (error) { console.warn("L·ªói c·∫≠p nh·∫≠t DB:", error); }
        }

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault(); 
            let inputVal = emailInput.value.trim();
            const password = passwordInput.value;
            if(!inputVal || !password) return showMessage("Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin", "error");

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> ƒêang x·ª≠ l√Ω...';

            try {
                let targetEmail = "";
                if (/^\d+$/.test(inputVal)) { // L√† s·ªë -> Check SƒêT
                    const q = query(collection(db, "users"), where("phone", "==", inputVal));
                    const querySnapshot = await getDocs(q);
                    if (querySnapshot.empty) throw new Error("SƒêT n√†y ch∆∞a ƒëƒÉng k√Ω!");
                    const userData = querySnapshot.docs[0].data();
                    targetEmail = userData.email || `${userData.username}@hocsinh.com`;
                } else { // L√† ch·ªØ -> Check Username
                    targetEmail = inputVal.includes('@') ? inputVal : `${inputVal}@hocsinh.com`;
                }

                const userCredential = await signInWithEmailAndPassword(auth, targetEmail, password);
                showMessage("ƒêƒÉng nh·∫≠p th√†nh c√¥ng!", "success");
                saveUserData(userCredential.user, "email");
                
                // ƒê√É X√ìA CHUY·ªÇN H∆Ø·ªöNG TH·ª¶ C√îNG - ƒê·ªÇ onAuthStateChanged T·ª∞ X·ª¨ L√ù
                // setTimeout(() => window.location.href = "dashboard.html", 500); 
                
            } catch (error) {
                console.error(error);
                let msg = "Sai th√¥ng tin ƒëƒÉng nh·∫≠p!";
                if(error.message.includes("SƒêT")) msg = error.message;
                showMessage(msg, "error");
                submitBtn.disabled = false; submitBtn.innerHTML = 'ƒêƒÉng nh·∫≠p ngay';
            }
        });

        // ƒêƒÇNG K√ù
        const registerForm = document.getElementById('registerForm');
        const regBtn = document.getElementById('regBtn');
        const regMessage = document.getElementById('regMessage');

        function showRegMessage(msg, type = 'success') {
            regMessage.textContent = msg;
            regMessage.classList.remove('hidden', 'text-green-600', 'text-red-600', 'bg-green-100', 'bg-red-100');
            regMessage.classList.add(type === 'success' ? 'text-green-600' : 'text-red-600');
            regMessage.classList.add(type === 'success' ? 'bg-green-100' : 'bg-red-100');
            regMessage.classList.remove('hidden');
        }

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            let username = document.getElementById('regUsername').value.trim().replace(/@/g, '').toLowerCase();
            const phone = document.getElementById('regPhone').value;
            const parentPhone = document.getElementById('regParentPhone').value;
            const year = document.getElementById('regYear').value;
            const school = document.getElementById('regSchool').value;
            const city = document.getElementById('regCity').value;
            const emailInput = document.getElementById('regEmail').value.trim();
            const pass = document.getElementById('regPass').value;
            const rePass = document.getElementById('regRePass').value;

            if (!/^[a-z0-9._]+$/.test(username)) return showRegMessage("T√™n ƒëƒÉng nh·∫≠p kh√¥ng d·∫•u, kh√¥ng kho·∫£ng tr·∫Øng!", "error");
            if (pass !== rePass) return showRegMessage("M·∫≠t kh·∫©u kh√¥ng kh·ªõp!", "error");
            
            regBtn.disabled = true; regBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> ƒêANG T·∫†O...';
            const fakeEmail = `${username}@hocsinh.com`;

            try {
                // Check SƒêT
                const qPhone = query(collection(db, "users"), where("phone", "==", phone));
                const snapPhone = await getDocs(qPhone);
                if (!snapPhone.empty) throw new Error("S·ªë ƒëi·ªán tho·∫°i n√†y ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω!");

                const userCredential = await createUserWithEmailAndPassword(auth, fakeEmail, pass);
                const user = userCredential.user;
                await updateProfile(user, { displayName: name });
                
                await setDoc(doc(db, "users", user.uid), {
                    displayName: name, username, email: fakeEmail, personalEmail: emailInput, phone, phoneParent: parentPhone,
                    birthYear: year, school, city, role: 'student', createdAt: new Date().toISOString(), authType: 'username', password: pass 
                });
                showRegMessage("ƒêƒÉng k√Ω th√†nh c√¥ng!", "success");
                
                // ƒê√É X√ìA CHUY·ªÇN H∆Ø·ªöNG TH·ª¶ C√îNG - ƒê·ªÇ onAuthStateChanged T·ª∞ X·ª¨ L√ù
                // setTimeout(() => window.location.href = "dashboard.html", 1000);
                
            } catch (error) {
                console.error(error);
                let msg = error.message;
                if (error.code === 'auth/email-already-in-use') msg = "T√™n ƒëƒÉng nh·∫≠p n√†y ƒë√£ c√≥ ng∆∞·ªùi d√πng!";
                showRegMessage(msg, "error");
                regBtn.disabled = false; regBtn.innerHTML = 'ƒêƒÇNG K√ù T√ÄI KHO·∫¢N';
            }
        });

         // --- LOGIC THANH TO√ÅN & VIETQR ---
        // --- LOGIC THANH TO√ÅN & VIETQR (ƒê√É FIX L·ªñI) ---
        let currentPayingCourse = null;
        let dynamicBankConfig = null;

        window.openPaymentModal = async (courseId) => {
            // 1. Ki·ªÉm tra ƒëƒÉng nh·∫≠p -> Chuy·ªÉn h∆∞·ªõng ƒêƒÇNG K√ù n·∫øu ch∆∞a c√≥ acc
            if (!auth.currentUser) {
                if(window.toggleRegisterModal) {
                    window.toggleRegisterModal(true); 
                    window.showNotification("Vui l√≤ng ƒêƒÉng k√Ω t√†i kho·∫£n ƒë·ªÉ ti·∫øp t·ª•c!", "info");
                } else {
                    alert("Vui l√≤ng ƒêƒÉng k√Ω t√†i kho·∫£n!");
                }
                return;
            }

            // 2. T·∫£i c·∫•u h√¨nh ng√¢n h√†ng (C√≥ d·ª± ph√≤ng l·ªói)
           if (!dynamicBankConfig) {
        try {
            const s = await getDoc(doc(db, "site_settings", "payment_config"));
            // Fallback n·∫øu ch∆∞a c·∫•u h√¨nh
            dynamicBankConfig = s.exists() ? s.data() : { BANK_ID: "970422", BANK_NAME: "MB Bank", ACCOUNT_NO: "0000", ACCOUNT_NAME: "ADMIN", TEMPLATE: "compact2" };
        } catch (e) { dynamicBankConfig = { BANK_ID: "970422", BANK_NAME: "L·ªói T·∫£i", ACCOUNT_NO: "0000", ACCOUNT_NAME: "ERR", TEMPLATE: "compact2" }; }
    }

    document.getElementById('paymentModal').classList.remove('opacity-0', 'pointer-events-none');
    document.getElementById('qrLoading').classList.remove('hidden');

    try {
        const snap = await getDoc(doc(db, "public_courses", courseId));
        if(snap.exists()){
            const c = snap.data();
            currentPayingCourse = { id: snap.id, ...c };
            const user = auth.currentUser;
            
            // 1. Hi·ªÉn th·ªã th√¥ng tin c∆° b·∫£n
            document.getElementById('payCourseTitle').innerText = c.title;
            document.getElementById('payCourseImg').src = c.thumbnail || 'https://placehold.co/150';
            
            // X·ª≠ l√Ω hi·ªÉn th·ªã gi√° (Format VND)
            let rawPrice = c.price;
            // Chuy·ªÉn ƒë·ªïi gi√° v·ªÅ s·ªë nguy√™n s·∫°ch (lo·∫°i b·ªè d·∫•u ch·∫•m, ph·∫©y, ch·ªØ ƒë)
            if (typeof rawPrice === 'string') {
                rawPrice = parseInt(rawPrice.replace(/\D/g, '')) || 0;
            }
            
            document.getElementById('payFinalPrice').innerText = rawPrice.toLocaleString('vi-VN') + 'ƒë';
            document.getElementById('payUserName').innerText = user.displayName;

            // 2. T·∫°o n·ªôi dung chuy·ªÉn kho·∫£n (Content)
            // C√∫ ph√°p: TTOAN <UID_NGAN> <COURSE_ID_NGAN>
            // Lo·∫°i b·ªè k√Ω t·ª± ƒë·∫∑c bi·ªát ƒë·ªÉ tr√°nh l·ªói URL
            const cleanUid = user.uid.substring(0,5).replace(/[^a-zA-Z0-9]/g, "");
            const cleanCourseId = c.id.substring(0,5).toUpperCase().replace(/[^a-zA-Z0-9]/g, "");
            const content = `TTOAN ${cleanUid} ${cleanCourseId}`;
            
            // 3. ƒêi·ªÅn th√¥ng tin ng√¢n h√†ng l√™n giao di·ªán
            // ∆Øu ti√™n hi·ªÉn th·ªã T√™n ng√¢n h√†ng (MB Bank) thay v√¨ m√£ BIN (970422)
            document.getElementById('bankNameDisplay').innerText = dynamicBankConfig.BANK_NAME || dynamicBankConfig.BANK_ID;
            document.getElementById('accountNoDisplay').innerText = dynamicBankConfig.ACCOUNT_NO;
            document.getElementById('transferContentDisplay').innerText = content;
            
            // 4. T·∫†O URL QR CODE VIETQR (FIX QUAN TR·ªåNG)
            // C·∫•u tr√∫c: https://img.vietqr.io/image/<BANK_ID>-<ACCOUNT_NO>-<TEMPLATE>.png?amount=<AMOUNT>&addInfo=<CONTENT>&accountName=<NAME>
            
            const bankId = dynamicBankConfig.BANK_ID;       // M√£ BIN (VD: 970422)
            const accNo = dynamicBankConfig.ACCOUNT_NO;     // S·ªë TK
            const template = dynamicBankConfig.TEMPLATE;    // Template (compact2)
            const amount = rawPrice;                        // S·ªë ti·ªÅn (Integer)
            const addInfo = encodeURIComponent(content);    // N·ªôi dung (URL Encoded)
            const accName = encodeURIComponent(dynamicBankConfig.ACCOUNT_NAME); // T√™n ch·ªß TK (URL Encoded)

            const qrUrl = `https://img.vietqr.io/image/${bankId}-${accNo}-${template}.png?amount=${amount}&addInfo=${addInfo}&accountName=${accName}`;
            
            // Debug link ƒë·ªÉ ki·ªÉm tra
            console.log("Generated QR Link:", qrUrl);

            const qrImg = document.getElementById('vietQrImage');
            qrImg.onload = () => document.getElementById('qrLoading').classList.add('hidden');
            qrImg.onerror = () => {
                document.getElementById('qrLoading').innerHTML = '<span class="text-red-500 font-bold">L·ªói t·∫°o m√£ QR</span>';
            };
            qrImg.src = qrUrl;
        }
    } catch(e){ console.error(e); }
};

        window.closePaymentModal = () => {
            const modal = document.getElementById('paymentModal');
            modal.classList.add('opacity-0', 'pointer-events-none');
        };

        window.copyText = (id) => { 
            navigator.clipboard.writeText(document.getElementById(id).innerText); 
            window.showNotification("ƒê√£ sao ch√©p!", "success"); 
        };

        window.confirmPayment = async () => {
            if(!currentPayingCourse) return;
            const btn = document.querySelector('button[onclick="confirmPayment()"]');
            const originText = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> ƒêang x·ª≠ l√Ω...'; btn.disabled = true;
            try {
                // L∆∞u v√†o Firestore
                await addDoc(collection(db, "orders"), {
                    userId: auth.currentUser.uid,
                    courseId: currentPayingCourse.id,
                    courseTitle: currentPayingCourse.title,
                    amount: parseInt(currentPayingCourse.price),
                    status: 'pending',
                    content: document.getElementById('transferContentDisplay').innerText,
                    createdAt: new Date().toISOString()
                });
                
                // ƒê√≥ng modal v√† th√¥ng b√°o
                window.closePaymentModal();
                // Hi·ªÉn th·ªã Modal th√†nh c√¥ng ho·∫∑c th√¥ng b√°o to
                alert("G·ª≠i x√°c nh·∫≠n th√†nh c√¥ng! Kh√≥a h·ªçc s·∫Ω ƒë∆∞·ª£c k√≠ch ho·∫°t sau 5-10 ph√∫t.");
            } catch(e) { 
                alert("L·ªói: " + e.message); 
            } finally { 
                btn.innerHTML = originText; btn.disabled = false; 
            }
        };
    </script>
</body>
</html>
